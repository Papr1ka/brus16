# Брус-16

Аппаратная реализация [учебной игровой приставки](https://github.com/true-grue/Brus-16).

## Архитектура

Подробнее об архитектуре можно узнать из презентации [Презентация](./docs/Брус-16.pdf).

Высокоуровневая схема архитектуры:

![Архитектура, вид сверху](./docs/architecture.png)

## Ключевые аспекты:

- Вывод через интерфейс 64 аппаратных прямоугольников.
- 16-битный программируемый процессор вычисляет следующий кадр.
- GPU без видеобуфера выводит текущий кадр.
- Управляющие сигналы (gpu_reset, copy_start, resume, copy) являются производными от vsync.
- (Грубо) По vsync (copy_start), DMA Rect copy и DMA Button controler подключаются к памяти данных, Rect copy копирует данные прямоугольников с пересчётом на абсолютные координаты в память GPU, Button controller записывает в память состояние кнопок.
- По заднему фронту vsync (resume), процессор возобновляет работу (Не начинает заново, а возобновляет с места остановки, что реализовано через флаг wait).
- Для разработки под приставку требуется ассемблер и компилятор.

## Код игры и эмулятор

Приставка прошита игрой про машинку в bsram.v.

Посмотреть на приставку в действии можно [здесь](https://true-grue.github.io/Brus-16-Demo/brus16.html).

## Симуляция

На текущий момент, доступна симуляция с помощью verilator.

Зависимости:
- компилятор c++
- verilator
- freeglut + freeglut-devel
- make

Запуск:
```
verilator -f verilator_vga.f
make -j -C obj_dir -f Vbrus16_top.mk Vbrus16_top
./obj_dir/Vbrus16_top 
```

Управление на стрелки (требует терпения).

## Тесты

Зависимости:
- cocotb
- icarus verilog
- make

Запуск:

`cd tests && make all`

## Перспектива

Запустить на [Tang nano 9k](https://wiki.sipeed.com/hardware/en/tang/Tang-Nano-9K/Nano-9K.html).
